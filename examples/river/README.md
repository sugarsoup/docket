# River Integration Example

This example demonstrates integrating Docket with [River](https://riverqueue.com), a robust Postgres-based job queue for Go.

## What This Shows

1. **Workflow as Job**: A River job executes a complete Docket graph
2. **Shared Postgres**: Both River and Docket persistence use the same `pgxpool`
3. **Execution ID Linking**: River job ID becomes the Docket execution ID for traceability
4. **Caching Across Jobs**: Same inputs hit the Docket cache, even across different River jobs
5. **Graceful Shutdown**: Context cancellation propagates from River to Docket

## Prerequisites

- Go 1.23+
- Docker

## Running

```bash
./run.sh
```

This will:
1. Start a temporary Postgres container
2. Create River tables
3. Run the example (enqueue jobs, process them, show cache hits)
4. Clean up

## Expected Output

```
ğŸš€ Starting Postgres container...
âœ… Postgres is ready!
ğŸ“¦ Running River migrations...
ğŸƒ Running example...

--- Enqueueing Jobs ---
Enqueued job for "hello"
Enqueued job for "world"
Enqueued job for "hello"

--- Processing Jobs ---
[Worker] Computing letter count for "hello"
[Worker] Computing letter count for "world"
(Note: second "hello" hits cache - no log)

--- Enqueueing Duplicate (should hit cache) ---
Enqueued duplicate job for "hello"
(Cache hit - no computation log)

--- Shutting Down ---
SUCCESS: River + Docket integration complete!
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Postgres                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    river_job        â”‚  â”‚     docket_cache         â”‚  â”‚
â”‚  â”‚  (job queue)        â”‚  â”‚   (step result cache)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    pgxpool.Pool   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   River   â”‚      â”‚ Docket  â”‚    â”‚ PostgresStore â”‚
    â”‚  Client   â”‚â”€â”€â”€â”€â”€â–¶â”‚   Graph     â”‚â”€â”€â”€â–¶â”‚   (cache)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

